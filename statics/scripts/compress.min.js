var sectionExt=function(){return[{type:"output",filter:function(a,b,c){a=a.replace(/<h([12])(.+?)>/g,"</section><section$2><h$1>").replace(/<section(.*?)><h2([\S\s]*?)<p><code>([\S\s]+?):([\S\s]+?)<\/code><\/p>/g,'<section id="$3" data-config="$3:$4"><h2$2');return a=a.replace("</section>","")+"</section>"}}]},h2Ext=function(){return[{type:"output",filter:function(a,b,c){return a=a.replace(/(<h2>)/g,"$1<span>").replace(/(<\/h2>)/g,"</span>$1")}}]},outlineExt=function(){return[{type:"output",filter:function(a,
b,c){b=a.match(/<section.*?data\-config=".+?:outline"[\S\s]*?<\/section>/g);for(var d in b)c=b[d].replace(/(<h2>[\S\s]*?<\/h2>)([\S\s]+?)<\/section>/g,'$1<section class="outline">$2</section></section>'),a=a.replace(b[d],c);return a}}]},listExt=function(){return[{type:"output",filter:function(a,b,c){b=a.match(/<section.*?data\-config=".+?:list"[\S\s]*?<\/section>/g);for(var d in b)c=b[d].match(/data\-config="(.+?):list"/)[1],c=b[d].replace(/<ul>([\S\s]*?)<\/ul>/g,'<select id="'+c+'">$1</select>').replace(/<li><a href="(.*?)">(.*?)<\/li>/g,
'<option value="$1">$2</option>'),a=a.replace(b[d],c);return a}}]},choiceExt=function(){return[{type:"output",filter:function(a,b,c){b=a.match(/<section.*?data\-config=".+?:choice[\S\s]*?<\/section>/g);for(var d in b){c=b[d].match(/data\-config="(.+?):choice/)[1];var e=b[d].replace(/<ul>([\S\s]*?)<\/ul>/g,'<div class="warning"></div><fieldset>$1</fieldset>'),g=e.match(/<li><a href=".+?">.+?<\/a><\/li>/g),f;for(f in g)var k=c+"_"+f,h=g[f].match(/<li><a href="(.+?)">(.+?)<\/a><\/li>/),e=e.replace(g[f],
'<div class="button choice" id="'+k+'" data-code="'+h[1]+'"><div class="row"><span class="icon"></span></div><div class="row">'+h[2]+"</div></div>");a=a.replace(b[d],e)}return a}}]},levelExt=function(){return[{type:"output",filter:function(a,b,c){b=a.match(/<section.*?data\-config=".+?:level[\S\s]*?<\/section>/g);for(var d in b){c=b[d].match(/data\-config="(.+?):level/)[1];var e=b[d].replace(/<ul>([\S\s]*?)<\/ul>/g,'<div class="warning"></div><fieldset class="inline">$1</fieldset>'),g=e.match(/<li><a href=".+?">.+?<\/a><\/li>/g),
f;for(f in g)var k=c+"_"+f,h=g[f].match(/<li><a href="(.+?)">(.+?)<\/a><\/li>/),e=e.replace(g[f],'<div class="button choice" id="'+k+'" data-code="'+h[1]+'"><div class="row"><span class="icon"></span></div><div class="row">'+h[2]+"</div></div>");a=a.replace(b[d],e)}return a}}]},rankExt=function(){return[{type:"output",filter:function(a,b,c){b=a.match(/<section.*?data\-config=".+?:rank[\S\s]*?<\/section>/g);for(var d in b){c=b[d].match(/data\-config="(.+?):rank/)[1];var e=b[d].replace(/<ul>([\S\s]*?)<\/ul>/g,
'<div class="warning"></div><fieldset>$1</fieldset>'),g=e.match(/<li><a href=".+?">.+?<\/a><\/li>/g),f;for(f in g)var k=c+"_"+f,h=g[f].match(/<li><a href="(.+?)">(.+?)<\/a><\/li>/),e=e.replace(g[f],'<label for="'+k+'"><div class="row"><input type="number"name="'+c+'" id="'+k+'" data-code="'+h[1]+'" min="1" step="1" required/></div><div class="row">'+h[2]+"</div></label>");a=a.replace(b[d],e)}return a}}]};
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,d){$jscomp.initSymbolIterator();c=null!=c?c:function(a){return a};var b=[],e=a[Symbol.iterator];if("function"==typeof e)for(a=e.call(a);!(e=a.next()).done;)b.push(c.call(d,e.value));else for(var e=a.length,g=0;g<e;g++)b.push(c.call(d,a[g]));return b}},"es6-impl","es3");
var nl2br=function(a){return a.replace(/([^>])\n/g,"$1<br/>\n")},$=function(a,b){return b?b.querySelector(a):document.querySelector(a)},$$=function(a,b){return b?b.querySelectorAll(a):document.querySelectorAll(a)},parseConfig=function(a){if(a=a.getAttribute("data-config"))try{var b=a.split(":")[0],c=a.split(":")[1];return["(",",",")"].map(function(a){return-1<c.indexOf(a)}).reduce(function(a,b){return a&&b})?{name:b,type:c.match(/(.+)\(/)[1],lowerBound:Number(c.match(/\d+/g)[0]),upperBound:Number(c.match(/\d+/g)[1])}:
{name:b,type:c}}catch(d){return{type:a}}},validate=function(a){var b=parseConfig(a);if(b){if("choice"===b.type)return a=$$(".button[data-selected=true]",a),a.length>=b.lowerBound&&a.length<=b.upperBound?null:"\u52fe\u9078\u9078\u9805\u6578\u76ee\u4e0d\u7b26\u5408\u984c\u76ee\u8981\u6c42\uff0c\u6700\u591a\u9078 "+b.upperBound+" \u500b\uff0c\u6700\u5c11\u9078 "+b.lowerBound+" \u500b";if("level"===b.type)return 1===$$(".button[data-selected=true]",a).length?null:"\u53ea\u80fd\u9078 1 \u500b";if("list"===
b.type)return null;if("rank"===b.type){var c=Array.from($$("input",a)),d=null;c.forEach(function(a){a.value||(d="\u6709\u672a\u586b\u6b04\u4f4d");1<c.filter(function(b){return a.value===b.value}).length&&(d="\u6392\u540d\u91cd\u8907")});return d}return null}},parseFilled=function(a){var b=parseConfig(a);if(b)return"choice"===b.type?(a=Array.from($$(".button[data-selected=true]",a)),1===b.upperBound?a.map(function(a){return a.getAttribute("data-code")})[0]:a.map(function(a){return a.getAttribute("data-code")})):
"level"===b.type?$(".button[data-selected=true]",a).getAttribute("data-code"):"list"===b.type?$("select",a).value:"rank"===b.type?(b=Array.from($$("input",a)).map(function(a){return{rank:Number(a.value),code:a.getAttribute("data-code")}}),b=b.sort(function(a,b){return a.rank<b.rank?-1:a.rank>b.rank?1:0}),b.map(function(a){return a.code})):null},getButton=function(a){return-1<a.className.indexOf("button")?a:-1<a.parentNode.className.indexOf("button")?a.parentNode:-1<a.parentNode.parentNode.className.indexOf("button")?
a.parentNode.parentNode:null};
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[e]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,e,b,c){if(e){b=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var d=a[c];d in b||(b[d]={});b=b[d]}a=a[a.length-1];c=b[a];e=e(c);e!=c&&null!=e&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,b,c){var d=this.length||0;0>b&&(b=Math.max(0,d+b));if(null==c||c>d)c=d;c=Number(c);0>c&&(c=Math.max(0,d+c));for(b=Number(b||0);b<c;b++)this[b]=a;return this}},"es6-impl","es3");
var distance=function(a,e){if(!a)return e?e.length:0;if(!e)return a.length;var b=a.length+2,c=e.length+2,d=a.length+e.length,g=Array(b).fill(0).map(function(){return Array(c).fill(0)}),k={};g[0][0]=d;for(var f=0;f<b-1;f++)g[f+1][0]=d,g[f+1][1]=f,k[a[f]]=0;for(f=0;f<c-1;f++)g[0][f+1]=d,g[1][f+1]=f,k[e[f]]=0;for(d=1;d<b-1;d++){for(var f=0,h=1;h<c-1;h++){var l=k[e[h-1]],m=f,n=a[d-1]===e[h-1]?0:1,f=a[d-1]===e[h-1]?h:f;g[d+1][h+1]=Math.min(g[d][h]+n,g[d+1][h]+1,g[d][h+1]+1,g[l][m]+(d-l-1)+1+(h-m-1))}k[a[d-
1]]=d}return 1-g[b-1][c-1]/(a.length*(a.length-1)/2)},overlap=function(a,e){var b=0,c;for(c in a)for(var d in e)a[c]===e[d]&&b++;return b/a.length},similarity=function(a,e,b,c){a=Number(a[a.length-1])-Number(a[0]);c=Math.abs(Number(b)-Number(c));return e?b===e?null:1-c/a:1-c/a};
var displayCandidateTemplate=function(a,c,b){return"<section><h2><span>\u7b2c "+a+" \u540d\uff1a"+b.name+"\uff0c\u76f8\u4f3c\u5ea6 "+Math.round(100*c)/100+" %\uff01</span></h2><p>\u9019\u4f4d\u662f"+((b.region?b.region:"")+" "+b.number+" \u865f")+'\u5019\u9078\u4eba\uff0c\u516c\u5831\u9023\u7d50<a target="_blank" href="'+b.link+'">\u5728\u6b64</a>\u3002</p><h3>\u9019\u4f4d\u5019\u9078\u4eba\u8a8d\u70ba...</h3><p>'+nl2br(b.description)+"</p></section>"},remainCandidateTemplate=function(a){return"<li>"+
((a.region?a.region:"")+" "+a.number+" \u865f")+"\u5019\u9078\u4eba\uff1a"+a.name+"\u3002</li>"};
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in b||(b[f]={});b=b[f]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,b,d){$jscomp.initSymbolIterator();b=null!=b?b:function(a){return a};var c=[],g=a[Symbol.iterator];if("function"==typeof g)for(a=g.call(a);!(g=a.next()).done;)c.push(b.call(d,g.value));else for(var g=a.length,e=0;e<g;e++)c.push(b.call(d,a[e]));return c}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var f=b++;return{value:c(f,a[f]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
var runLoading=function(a){a.style.display="block";a.innerHTML="Loading";return setInterval(function(){return a.innerHTML+="."},1E3)},stopLoading=function(a,c){clearInterval(a);c.style.display="none";c.innerHTML=""},processCandidate=function(a){ret=[];a.forEach(function(a){insert={};for(var b in a)-1<a[b].indexOf(",")?insert[b]=a[b].split(","):insert[b]=a[b];ret.push(insert)});return ret},toggleButton=function(a){"true"===a.getAttribute("data-selected")?a.removeAttribute("data-selected"):a.setAttribute("data-selected",
"true")},bindButtonBehavior=function(a){a=$("fieldset",a);var c=Array.from($$(".button",a));c.forEach(function(a){a.addEventListener("click",function(a){a.preventDefault();c.map(function(a){return a.removeAttribute("data-selected")});a=getButton(a.target);toggleButton(a)})})},bindButtonLimit=function(a){var c=parseConfig(a);$("fieldset",a);Array.from($$(".button",a)).forEach(function(b){b.addEventListener("click",function(b){b.preventDefault();b=getButton(b.target);toggleButton(b);var d=$$(".button[data-selected=true]",
a);c.upperBound&&d.length>c.upperBound&&(alert("\u5df2\u8d85\u904e\u53ef\u9078\u4e0a\u9650\uff01\u8acb\u5148\u53d6\u6d88\u9078\u64c7\u5176\u4ed6\u9078\u9805\u624d\u53ef\u4ee5\u518d\u9078\u5594\uff01"),toggleButton(b))})})},bindRankLimit=function(a){var c=Array.from($$("input[type=number]",a));c.forEach(function(a){a.setAttribute("max",c.length);a.addEventListener("change",function(a){1>a.target.value||a.target.value>c.length?(alert("\u4e0d\u80fd\u586b\u5165 1~"+c.length+" \u4ee5\u5916\u7684\u6578\u5b57\uff0c\u8acb\u66f4\u6b63\u3002"),
a.target.value=""):1<c.filter(function(b){return b.value===a.target.value}).length&&(alert("\u672c\u984c\u7d44\u5df2\u6709\u6392\u540d\u7b2c "+a.target.value+" \u7684\u9078\u9805\uff0c\u8acb\u66f4\u6b63\u3002"),a.target.value="")})})},initializeView=function(){Array.from($$("fieldset.inline")).forEach(function(a){3===$$(".button",a).length?a.className+=" elements-3":4===$$(".button",a).length?a.className+=" elements-4":5===$$(".button",a).length&&(a.className+=" elements-5")});Array.from($$("#test-render section")).forEach(function(a){var c=
parseConfig(a);c&&("level"===c.type?bindButtonBehavior(a):"choice"===c.type?1===c.upperBound?bindButtonBehavior(a):bindButtonLimit(a):"rank"===c.type&&bindRankLimit(a))})},initializeSubmit=function(a){$("#test form").addEventListener("submit",function(c){c.preventDefault();$("#result").style.display="none";$("#result-render").innerHTML="";var b=Array.from($$("section",c.target));c=!0;for(var d in b){var f=validate(b[d]);if(f){c=!1;alert($("h2",b[d]).innerText+"\u586b\u5beb\u6709\u8aa4\u5594\uff01"+
f+"\u3002");break}}if(c){var g={};b.forEach(function(a){var b=parseConfig(a);b&&"list"===b.type&&"*"!==parseFilled(a)&&(g[b.name]=parseFilled(a))});var e={};a.forEach(function(a){if(a.name){var c=e[a.name]=0;b.forEach(function(b){if(b=calculate(b,a))c+=1,e[a.name]+=b});e[a.name]=100*e[a.name]/c}});d=Object.keys(e).map(function(a){return{name:a,score:e[a]}});d=d.sort(function(a,b){return a.score>b.score?-1:a.score<b.score?1:0});renderResults(d,a,g);$("#result").style.display="block"}})},initializeDisplayNoAnswer=
function(a){$("#test form").addEventListener("submit",function(c){c.preventDefault();var b=$("#no-answer-render");b.innerHTML="";var d={};Array.from($$("section",c.target)).forEach(function(a){var b=parseConfig(a);b&&"list"===b.type&&"*"!==parseFilled(a)&&(d[b.name]=parseFilled(a))});a.forEach(function(a){var c=0<Object.keys(d).length?Object.keys(d).map(function(b){return a[b]===d[b]}).reduce(function(a,b){return a&&b}):!0;a.name&&c&&(b.innerHTML+=remainCandidateTemplate(a))})})},calculate=function(a,
c){var b=parseConfig(a);if(b){var d=parseFilled(a),f=c[a.id];return"level"===b.type?(b=Array.from($$(".button",a)).map(function(a){return a.getAttribute("data-code")}),similarity(b,b[Math.floor(b.length/2)],d,f)):"choice"===b.type?1===b.upperBound?(b=Array.from($$(".button",a)).map(function(a){return a.getAttribute("data-code")}),similarity(b,null,d,f)):overlap(d,f):"rank"===b.type?distance(d,f):null}},renderResults=function(a,c,b){var d=$("#result-render"),f=0;a.forEach(function(a){var e={},g;for(g in c){e.candidate=
c[g];var h=0<Object.keys(b).length?Object.keys(b).map(function(a){return function(c){return a.candidate[c]===b[c]}}(e)).reduce(function(a,b){return a&&b}):!0;e.candidate.name===a.name&&h&&(f+=1,d.innerHTML+=displayCandidateTemplate(f,a.score,e.candidate));e={candidate:e.candidate}}})};
